name: WIRU Serverless POC (matrix tests + sonar, clean flow)

on:
  push:
  workflow_dispatch:
permissions:
  contents: read

defaults:
  run:
    shell: bash

env:
  APP_NAME: ${{ github.event.inputs.app-name || 'my-app' }}
  STAGE: ${{ github.event.inputs.stage || 'dev' }}
  INPUT_VERSION: ${{ github.event.inputs.version || '' }}

jobs:
  init:
    name: "winstall"
    runs-on: ubuntu-latest
    steps:
      - name: Simulate init
        run: |
          echo "ðŸ§° Initializing workflow..."
          echo "APP_NAME: ${APP_NAME}"
          echo "STAGE: ${STAGE}"
          echo "VERSION: ${INPUT_VERSION}"

  wtest:
    needs: init
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix: { target: [wtest, wsonar] }
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node
        if: ${{ matrix.target == 'west' || matrix.target == 'wsonar' }}
        uses: actions/setup-node@v4
        with: { node-version: '20' }
      - name: Unit Tests
        if: ${{ matrix.target == 'west' }}
        shell: bash
        run: |
          echo "UNIT TESTS"
      - name: SonarQube Analysis
        if: ${{ matrix.target == 'wsonar' }}
        shell: bash
        run: |
          echo "SONAR (placeholder)"

